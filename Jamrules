# Please read the comments below carefully before you proceed!
#
# This file is for system that can not run `configure' script i.e. Win32
# platforms. If you are running a Unix box, MingW32 or Cygwin please run
# ./configure instead and use the auto-generated Jamrules file.

# uncomment the following line if you have Intel Fortran Compiler installed
USE_FORTRAN = 1 ;
if $(BCCROOT) {
    Echo Building with Borland C++ Tool Chain ;
    # tested on Borland Free C++ Compiler 5.5 with STLPort 4.5.3
    STDHDRS = ;
    STDLIBPATH = ;
    CCFLAGS = -w- -tWC -DWIN32 -DHAVE_CONFIG_H -DBOOST_DISABLE_THREADS -DHAVE_STRING_H=1 -P ;
    C++FLAGS = -w- -tWC -DWIN32 -DHAVE_CONFIG_H -DNDEBUG -DBOOST_DISABLE_THREADS -DBOOST_DISABLE_ASSERTS ;
    #OPTIM = -Od ;
    OPTIM = -O2 -6 -DNDEBUG ; # also tried -Ov and -xf but no obvious improvement
    LINKFLAGS = -tWC ;
    LINKLIBS = ;
} else if $(INTEL_COMPILER80) {
    Echo Building with Intel C++ for win32 Tool Chain ;
    # tested on Intel C++ 8.0 with MSVC7.1's headers & libs
    # uncomment the following line if you use STLPort with threading on
    # STLPORT_CFLAGS = /MT 
    STDHDRS = ;
    STDLIBPATH = ;
    CC = icl.exe ;
    CCFLAGS = /nologo /w /D "WIN32" /D "HAVE_CONFIG_H" /DHAVE_STRING_H=1 -DBOOST_DISABLE_THREADS
        $(STLPORT_CFLAGS) ;
    C++ = icl.exe ;
    C++FLAGS = /nologo /w /Zc:wchar_t /D "WIN32" /D "HAVE_CONFIG_H"
        -DBOOST_DISABLE_THREADS /D__EXCEPTIONS $(STLPORT_CFLAGS) ;
    #OPTIM = /Od /G6 ; # use /G7 for Intel Pentium 4 processors
    OPTIM = -DNDEBUG /O3 /G6 ; # use /G7 for Intel Pentium 4 processors
    LINK = icl.exe ;
    LINKFLAGS = ;
    LINKLIBS = ;
    actions Link bind NEEDLIBS
    {
        $(LINK) $(LINKFLAGS)  /Qoption,link,/out:$(<) $(UNDEFS) $(>) $(NEEDLIBS)
    }
} else if $(MSVCDIR) {
    Echo Building with MSVC Tool Chain ;
    # tested on MSVC7.1 with STLPort 
    #
    STLPORT_CFLAGS = /I$(MSVCDIR)/stlport/stlport ;
    CCFLAGS = /nologo /MD /GR /EHsc /w /D "WIN32" /D "HAVE_CONFIG_H"
	/DHAVE_STRING_H=1 -DBOOST_DISABLE_THREADS $(STLPORT_CFLAGS) ;
    C++FLAGS = /nologo /MD /GR /EHsc /w /D "WIN32" /D "HAVE_CONFIG_H"
        /DHAVE_STRING_H=1 -DBOOST_DISABLE_THREADS  $(STLPORT_CFLAGS) ; 
    #OPTIM = -DNDEBUG ;
    OPTIM = -DNDEBUG /O2 ;
    LINKFLAGS = /nologo ;
    LINKLIBS = ;

    if $(USE_FORTRAN) {
        # for Intel Fortran Compiler on win32
        CCFLAGS += /D"HAVE_FORTRAN"=1 ;
        C++FLAGS += /D"HAVE_FORTRAN"=1 ;
        FORTRAN = ifort.exe ;
        FORTRANFLAGS = /MD /O3 ;
        HAVE_FORTRAN = ifort.exe ;
        actions Fortran
        {
            $(FORTRAN) $(FORTRANFLAGS) /c /Fo$(<) $(>)
        }
    }
} else {
    EXIT C++ Compiler not found on Win32. Set BCCROOT, MSVCDIR or
    INTEL_COMPILER80 to the root of the Borland, Microsoft or Intel Compiler
    directories.  Read the manual.pdf for more. ;
}

HDRS = $(TOP) lib ;

